{"version":3,"sources":["../src/components/pointerEvents.ts"],"sourcesContent":["import type { CreatePluginType, EmblaCarouselType, OptionsHandlerType } from 'embla-carousel';\nimport { carouselClassNames } from '../Carousel';\n\nexport type PointerEventPluginOptions = {\n  onSelectViaDrag: (event: PointerEvent | MouseEvent, index: number) => void;\n};\n\nexport type PointerEventPlugin = CreatePluginType<{}, PointerEventPluginOptions>;\n\nexport function pointerEventPlugin(options: PointerEventPluginOptions): PointerEventPlugin {\n  let emblaApi: EmblaCarouselType;\n  let pointerEvent: PointerEvent | MouseEvent | undefined;\n  let carouselListenerTarget: HTMLElement | undefined;\n\n  /**\n   * Heads up!\n   *\n   * We don't use `emblaApi.on('pointerDown', ...)` as the callback does not provide the event.\n   */\n  function documentDownListener(event: PointerEvent | MouseEvent) {\n    if (event.target) {\n      const targetNode = event.target as Element;\n\n      if (targetNode.classList.contains(carouselClassNames.root) || carouselListenerTarget?.contains(targetNode)) {\n        pointerEvent = event;\n      }\n    }\n\n    if (carouselListenerTarget) {\n      carouselListenerTarget.removeEventListener('mousedown', documentDownListener);\n      carouselListenerTarget.removeEventListener('pointerdown', documentDownListener);\n    }\n  }\n\n  function pointerUpListener() {\n    if (carouselListenerTarget) {\n      carouselListenerTarget.addEventListener('mousedown', documentDownListener);\n      carouselListenerTarget.addEventListener('pointerdown', documentDownListener);\n    }\n  }\n\n  function clearPointerEvent() {\n    pointerEvent = undefined;\n    pointerUpListener();\n  }\n\n  function selectListener() {\n    if (pointerEvent) {\n      const newIndex = emblaApi.selectedScrollSnap() ?? 0;\n      options.onSelectViaDrag(pointerEvent, newIndex);\n    }\n  }\n\n  function init(emblaApiInstance: EmblaCarouselType, optionsHandler: OptionsHandlerType): void {\n    emblaApi = emblaApiInstance;\n    // Initialize the listener for first mouse/pointerDown event\n    carouselListenerTarget = emblaApi.containerNode();\n\n    carouselListenerTarget.addEventListener('mousedown', documentDownListener);\n    carouselListenerTarget.addEventListener('pointerdown', documentDownListener);\n\n    emblaApi.on('pointerUp', pointerUpListener);\n    emblaApi.on('select', selectListener);\n    // Settle is used to clear pointer and conclude drag event\n    emblaApi.on('settle', clearPointerEvent);\n  }\n\n  function destroy(): void {\n    if (carouselListenerTarget) {\n      carouselListenerTarget.removeEventListener('mousedown', documentDownListener);\n      carouselListenerTarget.removeEventListener('pointerdown', documentDownListener);\n    }\n\n    carouselListenerTarget = undefined;\n\n    emblaApi.off('pointerUp', pointerUpListener);\n    emblaApi.off('select', selectListener);\n    emblaApi.off('settle', clearPointerEvent);\n  }\n\n  return {\n    name: 'pointerEvent',\n    options,\n    init,\n    destroy,\n  };\n}\n"],"names":["carouselClassNames","pointerEventPlugin","options","emblaApi","pointerEvent","carouselListenerTarget","documentDownListener","event","target","targetNode","classList","contains","root","removeEventListener","pointerUpListener","addEventListener","clearPointerEvent","undefined","selectListener","newIndex","selectedScrollSnap","onSelectViaDrag","init","emblaApiInstance","optionsHandler","containerNode","on","destroy","off","name"],"mappings":"AACA,SAASA,kBAAkB,QAAQ,cAAc;AAQjD,OAAO,SAASC,mBAAmBC,OAAkC;IACnE,IAAIC;IACJ,IAAIC;IACJ,IAAIC;IAEJ;;;;GAIC,GACD,SAASC,qBAAqBC,KAAgC;QAC5D,IAAIA,MAAMC,MAAM,EAAE;YAChB,MAAMC,aAAaF,MAAMC,MAAM;YAE/B,IAAIC,WAAWC,SAAS,CAACC,QAAQ,CAACX,mBAAmBY,IAAI,MAAKP,mCAAAA,6CAAAA,uBAAwBM,QAAQ,CAACF,cAAa;gBAC1GL,eAAeG;YACjB;QACF;QAEA,IAAIF,wBAAwB;YAC1BA,uBAAuBQ,mBAAmB,CAAC,aAAaP;YACxDD,uBAAuBQ,mBAAmB,CAAC,eAAeP;QAC5D;IACF;IAEA,SAASQ;QACP,IAAIT,wBAAwB;YAC1BA,uBAAuBU,gBAAgB,CAAC,aAAaT;YACrDD,uBAAuBU,gBAAgB,CAAC,eAAeT;QACzD;IACF;IAEA,SAASU;QACPZ,eAAea;QACfH;IACF;IAEA,SAASI;QACP,IAAId,cAAc;gBACCD;YAAjB,MAAMgB,WAAWhB,CAAAA,+BAAAA,SAASiB,kBAAkB,gBAA3BjB,0CAAAA,+BAAiC;YAClDD,QAAQmB,eAAe,CAACjB,cAAce;QACxC;IACF;IAEA,SAASG,KAAKC,gBAAmC,EAAEC,cAAkC;QACnFrB,WAAWoB;QACX,4DAA4D;QAC5DlB,yBAAyBF,SAASsB,aAAa;QAE/CpB,uBAAuBU,gBAAgB,CAAC,aAAaT;QACrDD,uBAAuBU,gBAAgB,CAAC,eAAeT;QAEvDH,SAASuB,EAAE,CAAC,aAAaZ;QACzBX,SAASuB,EAAE,CAAC,UAAUR;QACtB,0DAA0D;QAC1Df,SAASuB,EAAE,CAAC,UAAUV;IACxB;IAEA,SAASW;QACP,IAAItB,wBAAwB;YAC1BA,uBAAuBQ,mBAAmB,CAAC,aAAaP;YACxDD,uBAAuBQ,mBAAmB,CAAC,eAAeP;QAC5D;QAEAD,yBAAyBY;QAEzBd,SAASyB,GAAG,CAAC,aAAad;QAC1BX,SAASyB,GAAG,CAAC,UAAUV;QACvBf,SAASyB,GAAG,CAAC,UAAUZ;IACzB;IAEA,OAAO;QACLa,MAAM;QACN3B;QACAoB;QACAK;IACF;AACF"}