{"version":3,"sources":["../src/usePositioningOptions.ts"],"sourcesContent":["'use client';\n\nimport { devtools } from '@floating-ui/devtools';\nimport { hide as hideMiddleware, arrow as arrowMiddleware } from '@floating-ui/dom';\nimport type { Middleware, Placement, Strategy } from '@floating-ui/dom';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport * as React from 'react';\n\nimport {\n  shift as shiftMiddleware,\n  flip as flipMiddleware,\n  coverTarget as coverTargetMiddleware,\n  maxSize as maxSizeMiddleware,\n  resetMaxSize as resetMaxSizeMiddleware,\n  offset as offsetMiddleware,\n  intersecting as intersectingMiddleware,\n  matchTargetSize as matchTargetSizeMiddleware,\n} from './middleware';\nimport type { PositioningConfigurationFn, PositioningConfigurationFnOptions, PositioningOptions } from './types';\nimport { toFloatingUIPlacement, hasScrollParent, normalizeAutoSize } from './utils';\nimport { devtoolsCallback } from './utils/devtools';\nimport { usePositioningConfiguration } from './PositioningConfigurationContext';\n\n/**\n * @internal\n *\n * This is redundant and exists only to manage React dependencies properly & avoid leaking individual options to the\n * scope of `usePositioningOptions`.\n */\nfunction usePositioningConfigFn(\n  configFn: PositioningConfigurationFn,\n  options: PositioningOptions,\n): (container: HTMLElement, arrow: HTMLElement | null) => PositioningConfigurationFnOptions {\n  const {\n    align,\n    arrowPadding,\n    autoSize,\n    coverTarget,\n    disableUpdateOnResize,\n    flipBoundary,\n    offset,\n    overflowBoundary,\n    pinned,\n    position,\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    unstable_disableTether,\n    strategy,\n    overflowBoundaryPadding,\n    fallbackPositions,\n    useTransform,\n    matchTargetSize,\n    shiftToCoverTarget,\n  } = options;\n\n  return React.useCallback(\n    (container: HTMLElement, arrow: HTMLElement | null) => {\n      return configFn({\n        container,\n        arrow,\n        options: {\n          autoSize,\n          disableUpdateOnResize,\n          matchTargetSize,\n          offset,\n          strategy,\n          coverTarget,\n          flipBoundary,\n          overflowBoundary,\n          useTransform,\n          overflowBoundaryPadding,\n          pinned,\n          arrowPadding,\n          align,\n          fallbackPositions,\n          shiftToCoverTarget,\n          position,\n          // eslint-disable-next-line @typescript-eslint/naming-convention\n          unstable_disableTether,\n        },\n      });\n    },\n    [\n      autoSize,\n      disableUpdateOnResize,\n      matchTargetSize,\n      offset,\n      strategy,\n      coverTarget,\n      flipBoundary,\n      overflowBoundary,\n      useTransform,\n      overflowBoundaryPadding,\n      pinned,\n      arrowPadding,\n      align,\n      fallbackPositions,\n      shiftToCoverTarget,\n      position,\n      unstable_disableTether,\n      configFn,\n    ],\n  );\n}\n\n/**\n * @internal\n */\nexport function usePositioningOptions(options: PositioningOptions): (\n  container: HTMLElement,\n  arrow: HTMLElement | null,\n) => {\n  placement: Placement | undefined;\n  middleware: Middleware[];\n  strategy: Strategy;\n  disableUpdateOnResize?: boolean;\n  useTransform?: boolean;\n} {\n  const { dir, targetDocument } = useFluent();\n  const isRtl = dir === 'rtl';\n\n  const configFn = usePositioningConfigFn(usePositioningConfiguration(), options);\n  const {\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\n    positionFixed,\n  } = options;\n\n  return React.useCallback(\n    (container: HTMLElement, arrow: HTMLElement | null) => {\n      const hasScrollableElement = hasScrollParent(container);\n\n      const optionsAfterEnhancement = configFn(container, arrow);\n      const {\n        autoSize,\n        disableUpdateOnResize,\n        matchTargetSize,\n        offset,\n        coverTarget,\n        flipBoundary,\n        overflowBoundary,\n        useTransform,\n        overflowBoundaryPadding,\n        pinned,\n        position,\n        arrowPadding,\n        strategy,\n        align,\n        fallbackPositions,\n        shiftToCoverTarget,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        unstable_disableTether,\n      } = optionsAfterEnhancement;\n      const normalizedAutoSize = normalizeAutoSize(autoSize);\n\n      const middleware = [\n        normalizedAutoSize && resetMaxSizeMiddleware(normalizedAutoSize),\n        matchTargetSize && matchTargetSizeMiddleware(),\n        offset && offsetMiddleware(offset),\n        coverTarget && coverTargetMiddleware(),\n        !pinned && flipMiddleware({ container, flipBoundary, hasScrollableElement, isRtl, fallbackPositions }),\n        shiftMiddleware({\n          container,\n          hasScrollableElement,\n          overflowBoundary,\n          disableTether: unstable_disableTether,\n          overflowBoundaryPadding,\n          isRtl,\n          shiftToCoverTarget,\n        }),\n        normalizedAutoSize &&\n          maxSizeMiddleware(normalizedAutoSize, { container, overflowBoundary, overflowBoundaryPadding, isRtl }),\n        intersectingMiddleware(),\n        arrow && arrowMiddleware({ element: arrow, padding: arrowPadding }),\n        hideMiddleware({ strategy: 'referenceHidden' }),\n        hideMiddleware({ strategy: 'escaped' }),\n        process.env.NODE_ENV !== 'production' &&\n          targetDocument &&\n          devtools(targetDocument, devtoolsCallback(optionsAfterEnhancement)),\n      ].filter(Boolean) as Middleware[];\n\n      const placement = toFloatingUIPlacement(align, position, isRtl);\n\n      return {\n        placement,\n        middleware,\n        strategy: strategy ?? positionFixed ? ('fixed' as const) : ('absolute' as const),\n\n        disableUpdateOnResize,\n        useTransform,\n      };\n    },\n    [configFn, isRtl, targetDocument, positionFixed],\n  );\n}\n"],"names":["devtools","hide","hideMiddleware","arrow","arrowMiddleware","useFluent_unstable","useFluent","React","shift","shiftMiddleware","flip","flipMiddleware","coverTarget","coverTargetMiddleware","maxSize","maxSizeMiddleware","resetMaxSize","resetMaxSizeMiddleware","offset","offsetMiddleware","intersecting","intersectingMiddleware","matchTargetSize","matchTargetSizeMiddleware","toFloatingUIPlacement","hasScrollParent","normalizeAutoSize","devtoolsCallback","usePositioningConfiguration","usePositioningConfigFn","configFn","options","align","arrowPadding","autoSize","disableUpdateOnResize","flipBoundary","overflowBoundary","pinned","position","unstable_disableTether","strategy","overflowBoundaryPadding","fallbackPositions","useTransform","shiftToCoverTarget","useCallback","container","usePositioningOptions","dir","targetDocument","isRtl","positionFixed","hasScrollableElement","optionsAfterEnhancement","normalizedAutoSize","middleware","disableTether","element","padding","process","env","NODE_ENV","filter","Boolean","placement"],"mappings":"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"}